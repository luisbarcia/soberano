{{/* layouts/_default/single.html */}}
{{/* Post header: title + date/time. Footer: [tags] + related posts. */}}

{{ define "title" }}{{ .Title }} · {{ site.Title }}{{ end }}

{{ define "main" }}

{{/* Reading progress bar */}}
<div class="reading-progress" aria-hidden="true">
  <div class="reading-progress__bar" id="reading-progress"></div>
</div>

<article>
  {{/* Post Header — clean: title + meta */}}
  <header class="post-header">
    <h1 class="post-header__title">{{ .Title }}</h1>

    {{/* Hero image — Page Resource (leaf bundle) or front matter path */}}
    {{ $heroImg := .Resources.GetMatch "cover.*" }}
    {{ if not $heroImg }}{{ $heroImg = .Resources.GetMatch "hero.*" }}{{ end }}
    {{ if not $heroImg }}{{ with .Params.image }}{{ $heroImg = $.Resources.GetMatch . }}{{ end }}{{ end }}
    {{ if $heroImg }}
      {{ partial "components/picture.html" (dict
        "img"     $heroImg
        "alt"     (.Params.cover_alt | default .Title)
        "loading" "eager"
        "class"   "post-header__image"
      ) }}
    {{ else }}
      {{ with .Params.image }}
      <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="post-header__image" loading="eager" decoding="async">
      {{ end }}
    {{ end }}

    {{ if not .Date.IsZero }}
    <div class="post-header__meta">
      <span>{{ .Date.Format "02 Jan 2006" }}</span>
      <span>{{ .ReadingTime }} {{ T "minRead" }}</span>
      {{ with .Params.author }}<span>{{ . }}</span>{{ end }}
      {{ with $.Params.tags }}
      <span class="post-header__tags">
        {{ range . }}<a href="{{ "tags/" | relURL }}{{ . | urlize }}/" class="post-tag">[{{ . }}]</a> {{ end }}
      </span>
      {{ end }}
    </div>
    {{ end }}
  </header>

  {{/* Table of Contents */}}
  {{ if and .Params.toc (gt (len .TableOfContents) 100) }}
  <nav class="toc" aria-label="Table of contents">
    <div class="toc__title">{{ T "contents" }}</div>
    {{ .TableOfContents }}
  </nav>
  {{ end }}

  {{/* Content */}}
  <div class="post-content" data-pagefind-body>
    {{ .Content }}
  </div>

  {{/* Post Footer — tags + related */}}
  <footer class="post-footer">

    {{/* Related posts */}}
    {{ if eq .Section "posts" }}
    {{ $related := first 3 (site.RegularPages.Related .) }}
    {{ with $related }}
    <aside class="related-posts" aria-label="Related posts">
      <div class="section-title">{{ T "related" }}</div>
      <div class="post-list">
        {{ range . }}
        {{ partial "post-item.html" . }}
        {{ end }}
      </div>
    </aside>
    {{ end }}
    {{ end }}

  </footer>
</article>

{{ end }}
